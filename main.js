var MDCSnackbar,apiURL=localStorage.getItem("apiURL")||"https://unshort-api-theta.vercel.app/";function escapeHtml(e){return e?"string"!=typeof e?e:e?.replace(/&/g,"&amp;")?.replace(/</g,"&lt;")?.replace(/>/g,"&gt;")?.replace(/"/g,"&quot;")?.replace(/'/g,"&#039;"):e}function simplifyURL(e){return e?(e.endsWith("/")&&(e=e.slice(0,-1)),e.startsWith("https://")&&(e=e.replace("https://","")),e.startsWith("http://")&&(e=e.replace("http://","")),e.startsWith("www.")&&(e=e.replace("www.","")),e):e}function loadingSearchButton(e,t){"check"==t?"add"===e?(document.getElementById("checkButton").disabled=!0,document.getElementById("check_button_loadingIcon").style.display=""):"remove"===e&&(document.getElementById("checkButton").disabled=!1,document.getElementById("check_button_loadingIcon").style.display="none"):"shorten"==t&&("add"===e?(document.getElementById("shortButton").disabled=!0,document.getElementById("short_button_loadingIcon").style.display=""):"remove"===e&&(document.getElementById("shortButton").disabled=!1,document.getElementById("short_button_loadingIcon").style.display="none"))}async function showSnackbar(e="Unknown",t,n){return document.querySelectorAll(".mdc-snackbar")&&document.querySelectorAll(".mdc-snackbar").forEach((e=>{e.remove()})),document.body.insertAdjacentHTML("beforeend",`<aside id="snack" class="mdc-snackbar"><div class="mdc-snackbar__surface" role="status" aria-relevant="additions"><div class="mdc-snackbar__label" aria-atomic="false">${e.replace(/"/g,'"')}</div>${n?`<div class="mdc-snackbar__actions" aria-atomic="true"><button onclick="${n?.replace(/"/g,'"')}" type="button" class="mdc-button mdc-snackbar__action"><div class="mdc-button__ripple"></div><span class="mdc-button__label">${t}</span></button></div>`:""}</div></aside>`),new mdc.snackbar.MDCSnackbar(document.querySelector(".mdc-snackbar")).open(),document.getElementById("snack")}async function checkUrl(e){if(!e?.length)return showSnackbar("Veuillez entrer une URL");loadingSearchButton("add","check"),e.startsWith("http://")||e.startsWith("https://")||(e="https://"+e);var t=await fetch(apiURL,{method:"POST",body:JSON.stringify({link:e})}).then((e=>e.json()));if(console.log(t),t?.error)return showSnackbar(t.message.slice(0,-1)),loadingSearchButton("remove","check");document.getElementById("result_info")&&document.getElementById("result_info").remove(),t.safe?document.getElementById("result_susText").classList.add("hidden"):document.getElementById("result_susText").classList.remove("hidden"),document.getElementById("result_shortcutURL").innerText=simplifyURL(t.url),document.getElementById("result_shortcutURL").href=escapeHtml(t.url),document.getElementById("result_originalURL").innerText=simplifyURL(t.redirected),document.getElementById("result_originalURL").href=escapeHtml(t.redirected),document.getElementById("result_qrCode").src=`https://api.qrserver.com/v1/create-qr-code/?data=${encodeURI(t.url||t.redirected)}&size=192x192`;var n=t.metadata.find((e=>"title"===e.name))?.content,o=t.metadata.find((e=>"description"===e.name))?.content;n?(document.getElementById("result_title").innerText=n,document.getElementById("result_title").parentElement.classList.remove("hidden")):document.getElementById("result_title").parentElement.classList.add("hidden"),o?(document.getElementById("result_description").innerText=o,document.getElementById("result_description").parentElement.classList.remove("hidden")):document.getElementById("result_description").parentElement.classList.add("hidden"),document.getElementById("result").classList.remove("hidden"),loadingSearchButton("remove","check");var r=localStorage.getItem("historic")||"[]";(r=(r=JSON.parse(r)).filter((e=>e.s!==t.url))).unshift({s:t.url,o:t.redirected}),r=r.slice(-11),localStorage.setItem("historic",JSON.stringify(r)),showHistoric()}async function shortenUrl(e,t,n){if(!e?.length)return showSnackbar("Veuillez entrer une URL");loadingSearchButton("add","shorten");var o=await moreshort.short(e,t,{shortcode:n}).catch((e=>({error:!0,message:e.message||e})));if("string"!=typeof o||o.error)return loadingSearchButton("remove","shorten"),showSnackbar(o.message||o.toString());var r=localStorage.getItem("historic")||"[]";(r=(r=(r=JSON.parse(r)).slice(-11)).filter((t=>t.s!==o.url||t.o!==e))).unshift({s:o,o:e}),r=r.slice(-11),localStorage.setItem("historic",JSON.stringify(r)),showHistoric(),document.getElementById("short_qrCode").src=`https://api.qrserver.com/v1/create-qr-code/?data=${encodeURI(o)}&size=192x192`,document.getElementById("short_shortcutURL").innerText=simplifyURL(o),document.getElementById("short_originalURL").innerText=simplifyURL(e),document.getElementById("short_shortcutURL").href=escapeHtml(o),document.getElementById("short_originalURL").href=escapeHtml(e),document.getElementById("shortResult").classList.remove("hidden"),document.getElementById("shortResultSeparator").classList.remove("hidden"),navigator.clipboard.writeText(o),loadingSearchButton("remove","shorten")}function showHistoric(){var e=localStorage.getItem("historic")||"[]";(e=JSON.parse(e)).length&&(document.getElementById("historic").innerHTML=e.map((e=>`<li class="mt-2 text-sm font-medium text-white break-all"><a class="underline" href="${escapeHtml(e.s)}">${escapeHtml(simplifyURL(e.s))}</a> : <a class="text-gray-400 font-normal underline" href="${escapeHtml(e.o)}">${escapeHtml(simplifyURL(e.o))}</a></li>`)).join(""),document.getElementById("historic").classList.remove("hidden"),document.getElementById("historic_info").classList.add("hidden"))}console.log("URL de l'API : ",apiURL),console.log("Vous pouvez définir la variable \"apiURL\" dans le stockage local :    localStorage.setItem('apiURL', 'https://unshort-api.vercel.app')"),window.onload=async function(){for(MDCSnackbar=mdc.snackbar.MDCSnackbar,navigator.onLine||showSnackbar("Aucune connexion internet","Réessayer","window.location.reload()"),window.location.hash&&window.dispatchEvent(new HashChangeEvent("hashchange")),showHistoric();!window.moreshort;)await new Promise((e=>setTimeout(e,200)));document.getElementById("provider").innerHTML+=Object.values(window.moreshort.servicesInfos).filter((e=>e.corsFriendly)).sort(((e,t)=>e.name.length-t.name.length)).map((e=>`<option${"rfrr.fr"==e.name?" selected":""}>${escapeHtml(e.name)}</option>`)).join(""),document.getElementById("thanks").innerHTML=window.moreshort.servicesCredits.filter((e=>e.corsFriendly)).map((e=>`<a class="underline" href="${e.website}">${escapeHtml(e.name)}</a>`)).join(", "),window.location.search.includes("explain")&&document.getElementById("explain").showModal()},window.onhashchange=function(){if(window.location.hash.startsWith("#check-")){var e=window.location.hash.substring(7);e.length&&(document.getElementById("url").value=decodeURIComponent(e),checkUrl(decodeURIComponent(e)))}},window.onkeydown=function(e){13==e.keyCode&&"url"===document.activeElement.id&&(e.preventDefault(),window.location.hash="#check-"+document.getElementById("url").value)};
